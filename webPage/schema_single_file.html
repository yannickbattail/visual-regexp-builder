<!DOCTYPE html>
<html>
<head>
<title>Visual RegExp builder</title>
<style type="text/css">
/* schema_custom.css */
#schema {
	min-height: 50px;
	margin: 0px;
}

.mainGroup {
	padding: 8px;
	padding-top: 0px;
	background-color: LightYellow;
}

#regexp {
	font-size: 16px;
	font-weight: bold;
	width: 400px;
	border-radius: 3px;
	border-width: 2px;
	border-style: inset;
}

.regexpOk {
	background-color: PaleGreen;
}

.regexpFailed {
	background-color: Tomato;
}

.showButtons {
	
}

}
.showButtons:HOVER {
	text-decoration: underline;
	border-style: solid;
	border-width: 1px;
}

#errMsg {
	background-color: LightGray;
}

.node {
	border-width: 2px;
	border-style: outset;
	border-radius: 10px;
	padding: 2px;
	margin-left: 20px;
	margin: 8px;
	background-color: Khaki;
	/*background-color: Chartreuse;*/
}

.nodeClass {
	border-width: 2px;
	border-style: outset;
	border-radius: 10px;
	padding: 2px;
	margin-left: 20px;
	margin: 8px;
	background-color: Turquoise;
	/*background-color: Chartreuse;*/
}

.group {
	border-width: 2px;
	border-style: inset;
	border-radius: 3px;
	padding: 3px;
	margin: 0px;
	background-color: LightYellow;
}

.mainGroup>.group {
	border-style: none;
}

.groupClass {
	border-width: 2px;
	border-style: inset;
	border-radius: 3px;
	padding: 3px;
	margin: 0px;
	background-color: LightCyan;
}

.showQuantifier {
	display: inline;
}

#recycledBin {
	width: 100px;
	height: 100px;
}

input:focus {
	background-color: AliceBlue;
}

[draggable=true] {
	cursor: move;
}

ul {
	margin: 2px;
	padding-left: 20px;
}

fieldset {
	border-radius: 5px;
	border-style: solid;
	border-width: 2px;
	border-color: black;
	padding: 5px;
	padding-top: 0px;
}

#recycledBin {
	background-repeat: no-repeat;
	background-position: center;
	background-image:
		url(data:image/png;base64,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);
}
</style>
<style type="text/css">
/* schema_mandatory.css */
#design {
}

#design>tr>td {
}


#buttons {
	display: none;
	position: absolute;
	background-color: white;
	border-width: 1px;
	border-style: solid;
}

.button {
	background-color: white;
	border-width: 1px;
	border-style: dotted;
}

.button:hover {
	background-color: grey;
}

#actionBar {
	font-weight: bold;
}

#close {
	display: inline;
	float: right;
}

#close:hover {
	background-color: grey;
}

.node {
	display: block;
}

.showButtons {
	display: inline;
}

.quantifier {
	/*display: inline;*/
	display: none;
}

#schema {
	width: 500px;
}

#recycledBin {
	width: 100px;
	height: 100px;
}

#ressources {
	width: 400px;
}
</style>
<script type="text/javascript">
/* htmlUtil.js */
var entityMap = {
    "&": "&amp;",
    "<": "&lt;",
    ">": "&gt;",
    '"': '&quot;',
    "'": '&#39;',
    "/": '&#x2F;'
};

function escapeHtml(string) {
    return String(string).replace(/[&<>"'\/]/g, function(s) {
        return entityMap[s];
    });
}

function gel(id) {
    return document.getElementById(id);
}

function getSel(id) {
    var e = gel(id);
    return e.options[e.selectedIndex].value;
}

function getValue(id) {
    var e = gel(id);
    if (e.tagName == 'SELECT') {
        return getSel(id);
    } else if (e.tagName == 'INPUT') {
        if (e.type == 'checkbox') {
            return gel(id).checked;
        } else {
            return gel(id).value;
        }
    }
    throw "unknown field type " + e.tagName;
}

function setValue(id, value) {
    var e = gel(id);
    if (e.tagName == 'SELECT') {
        return setSel(id, value);
    } else if (e.tagName == 'INPUT') {
        if (e.type == 'checkbox') {
            return gel(id).checked = value ? true : false;
        } else {
            return gel(id).value = value;
        }
    }
    throw "unknown field type" + e.tagName;
}

function setSel(id, value) {
    var sel = gel(id);
    for (var i, j = 0; i = sel.options[j]; j++) {
        if (i.value == value) {
            sel.selectedIndex = j;
            break;
        }
    }
}

</script>
<script type="text/javascript">
/* schema.js */
var currentId = 0;
var selectedNode = null;

function escapeCharFactor(string) {
    return String(string).replace(/[\\ \/\\\[\]{}()?+*|.\^$]/g, '\\$&');
}

function escapeCharClass(string) {
    return String(string).replace(/[\\ \/\\\[\]\^\-]/g, '\\$&');
}

function getNodeNum(selectedNode) {
    var t = selectedNode.id.split('-');
    return t[1];
}

function showQuantifier(event) {
    var n = getNodeNum(event.target);
    var quantifier = gel('quantifier-' + n);
    if (quantifier.style.display == 'inline') {
        quantifier.style.display = 'none';
    } else {
        quantifier.style.display = 'inline';
    }
}

function refesh() {
    buildRegexp();
    testRegexp();
}

function buildRegexp() {
    var regexp = '';
    regexp += buildRegexpRecurs(gel('schema'));
    if (getValue('atStart')) {
        regexp = '^' + regexp;
    }
    if (getValue('atEnd')) {
        regexp += '$';
    }
    regexp = '/' + regexp + '/';
    if (getValue('optG')) {
        regexp += 'g';
    }
    if (getValue('optI')) {
        regexp += 'i';
    }
    if (getValue('optM')) {
        regexp += 'm';
    }
    gel('regexp').value = regexp;
}

function buildRegexpRecurs(nodeRoot) {
    var nodes = nodeRoot.childNodes;
    var regexp = '';
    for (var i = 0; i < nodes.length; i++) {
        var node = nodes[i];
        if ((node.nodeType == Node.ELEMENT_NODE) && (node.className == 'node')) {
            var n = getNodeNum(node);
            var v1 = gel('value-' + n) ? getValue('value-' + n) : null;
            var v2 = gel('value2-' + n) ? getValue('value2-' + n) : null;
            if (gel('type-' + n).value == "text") {
                regexp += escapeCharFactor(v1);
                regexp += buildQuantifier(getValue('min-' + n), getValue('max-' + n));
            } else if (gel('type-' + n).value == "class") {
                regexp += '[';
                if (v1) {
                    regexp += '^';
                }
                regexp += buildClass(gel('group-' + n));
                regexp += ']';
                regexp += buildQuantifier(getValue('min-' + n), getValue('max-' + n));
            } else if (gel('type-' + n).value == "or") {
                regexp += '(';
                regexp += buildRegexpRecurs(gel('group-' + n));
                regexp += ')|(';
                regexp += buildRegexpRecurs(gel('group2-' + n));
                regexp += ')';
            } else if (gel('type-' + n).value == "group") {
                regexp += '(';
                if (v1) {
                    regexp += '?:';
                }
                regexp += buildRegexpRecurs(gel('group-' + n));
                regexp += ')';
                regexp += buildQuantifier(getValue('min-' + n), getValue('max-' + n));
            }
        }
    }
    return regexp;
}

function buildClass(nodeRoot) {
    var nodes = nodeRoot.childNodes;
    var regexp = '';
    for (var i = 0; i < nodes.length; i++) {
        var node = nodes[i];
        if ((node.nodeType == Node.ELEMENT_NODE) && (node.className == 'nodeClass')) {
            var n = getNodeNum(node);
            var v1 = gel('value-' + n) ? getValue('value-' + n) : null;
            var v2 = gel('value2-' + n) ? getValue('value2-' + n) : null;
            if (gel('type-' + n).value == "charClass") {
                regexp += escapeCharClass(v1);
            } else if (gel('type-' + n).value == "predefinedClass") {
                regexp += v1;
            } else if (gel('type-' + n).value == "charRange") {
                regexp += v1 + '-' + v2;
            }
        }
    }
    return regexp;
}

function buildQuantifier(v1, v2) {
    var regexp = '';
    if (!v1) {
        v1 = 0;
    }
    if (v1 == 0 && v2 == 1) {
        regexp += '?';
    } else if (v1 == 0 && v2 == '') {
        regexp += '*';
    } else if (v1 == 1 && v2 == '') {
        regexp += '+';
    } else if (v1 == 1 && v2 == 1) {
        regexp += '';
    } else if (v1 == v2) {
        regexp += '{' + v1 + '}';
    } else {
        regexp += '{' + v1 + ',' + v2 + '}';
    }
    return regexp;
}

function testRegexp() {
    try {
        var theRegexp = eval(gel('regexp').value);
        var res = gel('test').value.match(theRegexp);
        if (res == null) {
            gel('errMsg').innerHTML = 'Nothing matches in the string.';
            gel('result').value = '';
        } else {
            gel('result').value = res.join('\n');
            gel('result').value += res.toSource();
            gel('errMsg').innerHTML = '';
        }
        gel('regexp').className = 'regexpOk';
    } catch (e) {
        gel('errMsg').innerHTML = 'Some thing is wrong in the regexp. Error message: ' + e.message;
        gel('regexp').className = 'regexpFailed';
    }
    
}

function init() {
    selectedNode = gel('schema');
}

/***************** drag n drop *****************/

var dragged;

function drag(event) {
    event.dataTransfer.setData('text/plain', null);
}

/* events fired on the draggable target */
document.addEventListener("drag", function(event) {
    
}, false);

document.addEventListener("dragstart", function(event) {
    // store a ref. on the dragged elem
    dragged = event.target;
    // make it half transparent
    event.target.style.opacity = .5;
}, false);

document.addEventListener("dragend", function(event) {
    // reset the transparency
    event.target.style.opacity = "";
}, false);

/* events fired on the drop targets */
document.addEventListener("dragover", function(event) {
    // prevent default to allow drop
    event.preventDefault();
}, false);

document.addEventListener("dragenter", function(event) {
    // highlight potential drop target when the draggable element enters it
    var source = dragged.parentNode;
    var dest = event.target;
    var elem = dragged;
    
    // move dragged elem to the selected drop target
    if (isValidMove(source, dest, elem)) {
        if (dest.style) {
            dest.style.background = "chartreuse";
        }
    } else {
        if (dest.style) {
            dest.style.background = "red";
        }
    }
}, false);

document.addEventListener("dragleave", function(event) {
    // reset background of potential drop target when the draggable element leaves it
    // var source = dragged.parentNode;
    var dest = event.target;
    // var elem = dragged;
    if (dest.style) {
        dest.style.background = "";
    }
    
}, false);

document.addEventListener("drop", function(event) {
    // prevent default action (open as link for some elements)
    event.preventDefault();
    var source = dragged.parentNode;
    var dest = event.target;
    var elem = dragged;
    if (dest.style) {
        dest.style.background = "";
    }
    // move dragged elem to the selected drop target
    if (isValidMove(source, dest, elem)) {
        doMove(source, dest, elem);
    }
    
}, false);

function isValidMove(source, dest, elem) {
    if (dest == elem) {
        // dragged in the same node
        return false;
    }
    if ((dest.id == 'ressources') || (dest.parentNode.id == "ressources") || (dest.parentNode.parentNode.id == "ressources")) {
        return false;
    }
    // move dragged elem to the selected drop target
    if (dest.id == 'recycledBin') {
        if (source.id == "ressources") {
            return false;
        }
        return true;
    }
    if ((dest.className == "group") || (dest.parentNode.className == "group")) {
        if (elem.className == "node") {
            return true;
        }
    } else if ((dest.className == "groupClass") || (dest.parentNode.className == "groupClass")) {
        if (elem.className == "nodeClass") {
            return true;
        }
    }
    return false;
}

function doMove(source, dest, elem) {
    if (source.id == 'ressources') {
        var newNode = elem.cloneNode(true);
        currentId++;
        newNode.innerHTML = newNode.innerHTML.replace(new RegExp('XXX', 'g'), String(currentId));
        newNode.innerHTML = newNode.innerHTML.replace('disabled="disabled"', '');
        newNode.id = newNode.id.replace('XXX', String(currentId));
        newNode.setAttribute("style", "");
        elem = newNode;
    } else {
        source.removeChild(elem);
    }
    if (dest.id != 'recycledBin') {
        if ((dest.parentNode.className == "group") || (dest.parentNode.className == "groupClass")) {
            dest.parentNode.insertBefore(elem, dest);
        } else {
            dest.appendChild(elem);
        }
    }
    refesh();
}

</script>
</head>
<body>
	<h1>building schema</h1>
	<table id="design">
		<tr>
			<td><input type="checkbox" id="atStart" value="1"
				onchange="refesh()" /> At begining of string/line<br />
				<fieldset class="mainGroup">
					<legend> The schema </legend>
					<div id="schema" class="group"></div>
				</fieldset> <input type="checkbox" id="atEnd" value="1" onchange="refesh()" />
				At end of string/line<br /> Options:
				<ul>
					<li><input type="checkbox" id="optG" value="1"
						onchange="refesh()" />Global match (match several times)</li>
					<li><input type="checkbox" id="optI" value="1"
						onchange="refesh()" />Ignore case</li>
					<li><input type="checkbox" id="optM" value="1"
						onchange="refesh()" />Working over multiple lines</li>
				</ul></td>
			<td>
				<fieldset class="mainGroup">
					<legend>Recycled bin</legend>
					<div id="recycledBin" class="group"></div>
				</fieldset>
			</td>
			<td>
				<fieldset class="mainGroup">
					<legend>Ressources (Drag and drop them in the schema)</legend>
					<div id="ressources" class="group">
						<div id="node-XXX" class="node" ondragstart="drag(event)"
							draggable="true">
							<input type="hidden" id="type-XXX" value="text" /> Text <input
								type="text" id="value-XXX" value="Hello" onkeyup="refesh()"
								onfocus="this.parentNode.draggable=false"
								onblur="this.parentNode.draggable=true" />
							<button id="showQuantifier-XXX" onclick="showQuantifier(event)"
								class="showQuantifier" disabled="disabled">+</button>
							<div id="quantifier-XXX" class="quantifier">
								from <input type="text" id="min-XXX" value="1" size="2"
									onkeyup="refesh()" />times to <input type="text" id="max-XXX"
									value="1" size="2" onkeyup="refesh()" />times
							</div>
						</div>

						<div id="node-XXX" class="nodeClass" ondragstart="drag(event)"
							draggable="true">
							<input type="hidden" id="type-XXX" value="charClass" /> one of
							theses char <input type="text" id="value-XXX" value="aeiouy"
								onkeyup="refesh()" />
						</div>

						<div id="node-XXX" class="nodeClass" ondragstart="drag(event)"
							draggable="true">
							<input type="hidden" id="type-XXX" value="predefinedClass" />
							one char <select id="value-XXX" onchange="refesh()">
								<option value="\d">digit</option>
								<option value="\s">whitespace</option>
								<option value="\w">word character</option>
								<option value="\t">tab</option>
								<option value="\n">new line</option>
								<option value="\r">carriage return</option>
								<option value="\f">form feed</option>
								<option value="\b">backspace</option>
								<option value="a-z">alpha lower case</option>
								<option value="A-Z">alpha upper case</option>
								<option value="a-zA-Z">alpha upper and lower</option>
								<option value="a-zA-Z0-9">alphanum</option>
								<option value="a-f0-9">hexadecimal lowercase</option>
								<option value="A-F0-9">hexadecimal uppercase</option>
								<option value="a-fA-F0-9">hexa upper and lower</option>
							</select>
						</div>

						<div id="node-XXX" class="nodeClass" ondragstart="drag(event)"
							draggable="true">
							<input type="hidden" id="type-XXX" value="charRange" /> from
							char <input type="text" id="value-XXX" value="a" size="2"
								onkeyup="refesh()" /> to char <input type="text"
								id="value2-XXX" value="z" size="2" onkeyup="refesh()" />
						</div>

						<div id="node-XXX" class="node" ondragstart="drag(event)"
							draggable="true">
							<input type="hidden" id="type-XXX" value="class" /> (Not<input
								type="checkbox" id="value-XXX" value="1" onchange="refesh()" />)
							one char of this list
							<button id="showQuantifier-XXX" onclick="showQuantifier(event)"
								class="showQuantifier" disabled="disabled">+</button>
							<div id="quantifier-XXX" class="quantifier">
								from <input type="text" id="min-XXX" value="1" size="2"
									onkeyup="refesh()" />times to <input type="text" id="max-XXX"
									value="1" size="2" onkeyup="refesh()" />times
							</div>
							<div id="group-XXX" class="groupClass"></div>
						</div>

						<div id="node-XXX" class="node" ondragstart="drag(event)"
							draggable="true">
							<div id="group-XXX" class="group"></div>
							<input type="hidden" id="type-XXX" value="or" /> OR
							<div id="group2-XXX" class="group"></div>
						</div>

						<div id="node-XXX" class="node" ondragstart="drag(event)"
							draggable="true">
							<input type="hidden" id="type-XXX" value="group" /> Group (not<input
								type="checkbox" id="value-XXX" value="1" onchange="refesh()" />
							capturing)
							<button id="showQuantifier-XXX" onclick="showQuantifier(event)"
								class="showQuantifier" disabled="disabled">+</button>
							<div id="quantifier-XXX" class="quantifier">
								from <input type="text" id="min-XXX" value="1" size="2"
									onkeyup="refesh()" />times to <input type="text" id="max-XXX"
									value="1" size="2" onkeyup="refesh()" />times
							</div>
							<div id="group-XXX" class="group"></div>
						</div>
					</div>
				</fieldset>
			</td>
		</tr>
	</table>
	<fieldset>
		<legend> The regexp </legend>
		<input type="text" id="regexp" value="" readonly="readonly" />
	</fieldset>
	<hr />
	<table>
		<tr>
			<td>
				<fieldset>
					<legend> Test string </legend>
					<textarea id="test" onkeyup="testRegexp()"></textarea>
				</fieldset>
			</td>
		</tr>
		<tr>
			<td><div id="errMsg"></div></td>
		</tr>
		<tr>
			<td>
				<fieldset>
					<legend> Result </legend>
					<textarea id="result" onkeyup="testRegexp()"></textarea>
				</fieldset>
			</td>
		</tr>
	</table>
</body>
<script type="text/javascript">
    init();
</script>
</html>

